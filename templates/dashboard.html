{% extends "layout_app.html" %}
{% block title %}Dashboard - Diabetes Prediction System{% endblock %}

{% block content %}

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
/* Sidebar Matching Color Palette (No Purple) */
:root {
  --sidebar-bg: #1e293b;    /* Dark Navy/Slate from sidebar */
  --accent-green: #22c55e;   /* Bright Green for Suggestion/Action */
  --body-bg: #f8fafc;       /* Clean Light Gray background */
}

/* Animations */
@keyframes slideDown {
  from { opacity: 0; transform: translateY(-40px); }
  to { opacity: 1; transform: translateY(0); }
}
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}
@keyframes bounceIn {
  0% { transform: scale(0.8); opacity: 0; }
  60% { transform: scale(1.05); }
  100% { transform: scale(1); opacity: 1; }
}

.animate-slide { animation: slideDown 1s ease forwards; }
.animate-fade { animation: fadeIn 1.2s ease forwards; }
.animate-bounce { animation: bounceIn 1s ease forwards; }

.font-poppins { font-family: 'Poppins', sans-serif; }

/* Subtle card hover effect */
.card-hover:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 25px rgba(30, 41, 59, 0.1);
}
</style>

<div class="flex flex-col min-h-screen bg-[var(--body-bg)] font-poppins">

<main class="flex-1 overflow-y-auto pt-8 px-4 md:px-12">

  <section class="relative bg-white text-[var(--sidebar-bg)] py-12 px-6 rounded-[40px] shadow-sm mb-12 border border-gray-100 overflow-hidden">
    <div class="absolute -top-10 -right-10 w-32 h-32 bg-[var(--accent-green)] opacity-5 rounded-full"></div>
  
    <div class="max-w-3xl mx-auto text-center space-y-4 relative z-10">
      <h1 class="text-3xl md:text-5xl font-extrabold tracking-tight">
        Welcome to <span class="text-[--emerald]">Diabetes Prediction</span>
      </h1>
      
      <p class="text-gray-500 text-base md:text-lg font-medium">
        Predict • Prevent • Protect your health
      </p>
      
      <div class="flex flex-wrap justify-center gap-4 mt-6">
        <a href="{{ url_for('prediction') }}"
           class="px-8 py-3 bg-[var(--sidebar-bg)] text-white text-md font-bold rounded-2xl shadow-md hover:bg-black transition-all transform hover:scale-105">
          Get Prediction
        </a>
        <a href="{{ url_for('suggestion') }}"
           class="px-8 py-3 bg-emerald-500 text-white text-md font-bold rounded-2xl shadow-md hover:brightness-110 transition-all transform hover:scale-105">
          Health Tips
        </a>
      </div>
    </div>
  </section>

<section class="mb-16">
  <div class="text-center mb-12">
    <h2 class="text-3xl md:text-4xl font-bold text-[var(--sidebar-bg)]">Key Features</h2>
    <div class="h-1.5 w-24 bg-emerald-500 mx-auto mt-4 rounded-full"></div>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
    {% for feature, desc in {
      'Prediction': 'Upload health data and get diabetes risk prediction instantly.',
      'Suggestions': 'Personalized lifestyle and diet tips to reduce risk.',
      'Reports': 'Download detailed reports for tracking your progress.'
    }.items() %}
    <div class="bg-white p-8 rounded-[2rem] shadow-sm border border-gray-100 card-hover transition-all duration-300 flex flex-col h-full">
      <div class="flex items-center mb-6 space-x-4">
        <div class="p-3 bg-slate-50 rounded-2xl">
            <i class="fa-solid fa-heart-pulse text-[var(--sidebar-bg)] text-3xl"></i>
        </div>
        <h4 class="text-xl font-bold text-[var(--sidebar-bg)]">{{ feature }}</h4>
      </div>
      <p class="text-gray-600 leading-relaxed mb-8 flex-1 text-lg">{{ desc }}</p>
      <button onclick="openFeatureModal('{{ feature }}')" 
  class="mt-auto w-full py-4 bg-[var(--sidebar-bg)] text-white rounded-2xl hover:bg-black transition-colors font-bold tracking-wide">
  Explore {{ feature }} →
</button>

    </div>
    {% endfor %}
  </div>
</section>

<section class="mb-16 bg-[var(--sidebar-bg)] py-16 px-6 md:px-12 rounded-[3rem] shadow-xl text-white">
  <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center">
    {% for num, label in [(120, 'Predictions Made'), (85, 'Accuracy Rate %'), (80, 'Users Helped')] %}
    <div class="flex flex-col items-center">
      <h3 class="text-5xl font-extrabold text-emerald-500 counter" data-target="{{ num }}">0</h3>

      <p class="text-gray-300 font-bold mt-2 text-lg uppercase tracking-wider">{{ label }}</p>
    </div>
    {% endfor %}
  </div>
</section>

<section class="mb-16 pb-12">
  <div class="text-center mb-12">
    <h2 class="text-3xl md:text-4xl font-bold text-[var(--sidebar-bg)]">Health Insights</h2>
    <div class="h-1.5 w-24 bg-emerald-500 mx-auto mt-4 rounded-full"></div>
  </div>

  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
    {% for topic, data in {
      'What is Diabetes?': ['A chronic condition affecting blood sugar levels.', 'what'],
      'Symptoms': ['Early warning signs of diabetes.', 'symptoms'],
      'Causes': ['Lifestyle and genetic factors.', 'causes'],
      'Prevention': ['Healthy habits to reduce risk.', 'prevention']
    }.items() %}
    <div class="bg-white p-6 rounded-[2rem] shadow-sm border border-gray-50 hover:border-[var(--accent-green)] transition-all flex flex-col h-full">
      <h3 class="text-lg font-bold text-[var(--sidebar-bg)] mb-3">{{ topic }}</h3>
      <p class="text-gray-500 mb-6 text-sm leading-relaxed flex-1">{{ data[0] }}</p>
      <button onclick="openAbout('{{ data[1] }}')" 
              class="mt-auto w-full py-3 border-2 border-[var(--sidebar-bg)] text-[var(--sidebar-bg)] rounded-xl hover:bg-[var(--sidebar-bg)] hover:text-white transition-all font-bold">
        View Details
      </button>
    </div>
    {% endfor %}
  </div>
</section>

</main>
<!-- Feature Modal -->
<!-- Feature Modal -->
<div id="featureModal" 
     class="fixed inset-0 bg-[#0f172a]/80 backdrop-blur-md hidden items-center justify-center z-[100] p-4 transition-all duration-300">
    
  <div class="bg-white rounded-[2.5rem] shadow-2xl w-full max-w-2xl overflow-hidden relative animate-fade-in border border-white/20">
        
    <div class="h-2 w-full bg-gradient-to-r from-emerald-400 via-[--navy] to-indigo-500"></div>

    <div class="p-8 md:p-12">
      <button onclick="closeFeatureModal()" 
              class="absolute top-8 right-8 w-10 h-10 flex items-center justify-center rounded-full bg-slate-50 text-gray-400 hover:bg-red-50 hover:text-red-500 transition-all group">
        <i class="fa-solid fa-xmark text-xl"></i>
      </button>

      <div class="mb-8">
        <h3 id="featureTitle" class="text-3xl md:text-4xl font-extrabold text-[--navy] tracking-tight"></h3>
        <div class="h-1 w-20 bg-emerald-500 mt-3 rounded-full"></div>
      </div>

      <div id="featureContent" 
           class="text-gray-600 text-lg leading-relaxed space-y-4 max-h-[55vh] overflow-y-auto pr-4">
      </div>

      <!-- Action Buttons -->
      <div class="mt-10 grid grid-cols-1 md:grid-cols-2 gap-4">
        
        <!-- Normal Feature Button -->
        <a id="featureLink"
           class="text-center py-4 bg-[var(--sidebar-bg)] text-white font-bold text-lg rounded-2xl hover:bg-black transition-all hidden">
           Go to Feature
        </a>

        <!-- Report Download Button -->
        <a id="downloadReportBtn"
        href="{{ url_for('download_current_report', user_id=session['id']) }}"
        class="w-full text-center py-4
               bg-black text-white
               font-bold text-lg
               rounded-2xl
               hover:bg-gray-900
               transition-all duration-200
               flex items-center justify-center gap-3
               shadow-lg shadow-black/20">
     
        <i class="fa-solid fa-file-pdf text-emerald-500 text-xl"></i>
        <span>Download Medical Report</span>
     </a>
     



        <button onclick="closeFeatureModal()" 
                class="py-4 bg-slate-100 text-[--navy] font-bold text-lg rounded-2xl hover:bg-slate-200 transition-all">
          Close
        </button>
      </div>
    </div>
  </div>
</div>



<div id="detailsModal" 
     class="fixed inset-0 bg-[#0f172a]/80 backdrop-blur-md hidden items-center justify-center z-[100] p-4 transition-all duration-300">
    
    <div class="bg-white rounded-[2.5rem] shadow-2xl w-full max-w-2xl overflow-hidden relative animate-fade-in border border-white/20">
        
        <div class="h-2 w-full bg-gradient-to-r from-emerald-400 via-[--navy] to-indigo-500"></div>

        <div class="p-8 md:p-12">
            <button onclick="closeModal()" 
                    class="absolute top-8 right-8 w-10 h-10 flex items-center justify-center rounded-full bg-slate-50 text-gray-400 hover:bg-red-50 hover:text-red-500 transition-all duration-200 group">
                <i class="fa-solid fa-xmark text-xl group-hover:scale-110 transition-transform"></i>
            </button>

            <div class="mb-8">
                <h3 id="modalTitle" class="text-3xl md:text-4xl font-extrabold text-[--navy] tracking-tight leading-tight">
                    </h3>
                <div class="h-1 w-20 bg-emerald-500 mt-3 rounded-full"></div>
            </div>

            <div id="modalContent" 
                 class="text-gray-600 text-lg leading-relaxed space-y-4 max-h-[55vh] overflow-y-auto pr-4 custom-scrollbar">
                </div>

            <div class="mt-10">
                <button onclick="closeModal()" 
                        class="w-full py-4 bg-slate-100 text-[--navy] font-bold text-lg rounded-2xl hover:bg-slate-200 active:scale-[0.98] transition-all flex items-center justify-center gap-2">
                    Close Window
                </button>
            </div>
        </div>

  
</div>

<script>
const aboutData = {
  what: { title: "What is Diabetes?", content: `<ul class="space-y-2"><li>● Type 1 – No insulin production</li><li>● Type 2 – Insulin resistance</li><li>● Gestational Diabetes</li></ul>` },
  symptoms: { title: "Symptoms", content: `<ul class="space-y-2"><li>● Frequent urination</li><li>● Increased thirst</li><li>● Fatigue</li><li>● Blurred vision</li></ul>` },
  causes: { title: "Causes", content: `<ul class="space-y-2"><li>● Genetics</li><li>● Obesity</li><li>● Poor diet</li><li>● Inactive lifestyle</li></ul>` },
  prevention: { title: "Prevention", content: `<ul class="space-y-2"><li>● Healthy diet</li><li>● Exercise</li><li>● Weight control</li><li>● Checkups</li></ul>` }
};

function openAbout(type) {
  document.getElementById("modalTitle").innerText = aboutData[type].title;
  document.getElementById("modalContent").innerHTML = aboutData[type].content;
  document.getElementById("detailsModal").classList.remove("hidden");
  document.getElementById("detailsModal").classList.add("flex");
}

function closeModal() {
  document.getElementById("detailsModal").classList.add("hidden");
  document.getElementById("detailsModal").classList.remove("flex");
}

const counters = document.querySelectorAll('.counter');
const observer = new IntersectionObserver(entries => {
  entries.forEach(entry => {
    if (entry.isIntersecting) {
      let el = entry.target;
      let target = parseInt(el.dataset.target);
      let count = 0;
      let step = Math.ceil(target / 80);
      let interval = setInterval(() => {
        count += step;
        if (count >= target) {
          count = target;
          clearInterval(interval);
        }
        el.innerText = count;
      }, 25);
      observer.unobserve(el);
    }
  });
});
counters.forEach(c => observer.observe(c));


const featureData = {
    "Prediction": {
      title: "Diabetes Risk Prediction",
      content: `
        <p><strong>Workflow:</strong></p>
        <ul class="list-disc pl-6 space-y-2">
          <li>User enters Age, BMI, Glucose, HbA1c & Health History</li>
          <li>System processes data using trained ML Model</li>
          <li>Risk result displayed with health status badge</li>
          <li>Prediction stored in user history & admin panel</li>
        </ul>
        <p><strong>Best Use:</strong> Early detection & prevention planning</p>
      `,
      link: "{{ url_for('prediction') }}"
    },
  
    "Suggestions": {
      title: "Personalized Health Suggestions",
      content: `
        <p><strong>What You Get:</strong></p>
        <ul class="list-disc pl-6 space-y-2">
          <li>Diet plans based on your risk level</li>
          <li>Daily exercise routines</li>
          <li>Blood sugar improvement tips</li>
          <li>Healthy lifestyle tracking advice</li>
        </ul>
        <p><strong>Goal:</strong> Natural diabetes risk reduction</p>
      `,
      link: "{{ url_for('suggestion') }}"
    },
  
    "Reports": {
      title: "Medical & Progress Reports",
      content: `
        <div class="space-y-4">
          
          <p class="font-semibold text-slate-800">Includes:</p>
    
          <ul class="list-disc pl-6 space-y-2 text-slate-700">
            <li>Complete prediction history with timestamps</li>
            <li>Interactive health trend charts & insights</li>
            <li>Downloadable PDF reports for offline access</li>
            <li>Doctor-friendly medical summary & key metrics</li>
            <li>Secure data handling with privacy protection</li>
          </ul>
    
          <p class="font-semibold text-slate-800 pt-2">
            Formats:
            <span class="font-normal text-slate-600">
              PDF, printable view, and shareable links
            </span>
          </p>
    
          <p class="font-semibold text-slate-800">
            Use:
            <span class="font-normal text-slate-600">
              Clinical review, long-term monitoring, and patient-doctor communication
            </span>
          </p>
    
        </div>
      `
    }
    
  };
  
  function openFeatureModal(feature) {
    const data = featureData[feature];
  
    const title = document.getElementById("featureTitle");
    const content = document.getElementById("featureContent");
    const linkBtn = document.getElementById("featureLink");
    const downloadBtn = document.getElementById("downloadReportBtn");
  
    // Set text
    title.innerText = data.title;
    content.innerHTML = data.content;
  
    // Hide both buttons first
    linkBtn.classList.add("hidden");
    downloadBtn.classList.add("hidden");
  
    // Show correct button
    if (feature === "Reports") {
      downloadBtn.classList.remove("hidden");
    } else {
      linkBtn.href = data.link;
      linkBtn.classList.remove("hidden");
    }
  
    // Show modal
    const modal = document.getElementById("featureModal");
    modal.classList.remove("hidden");
    modal.classList.add("flex");
  }
  
  function closeFeatureModal() {
    const modal = document.getElementById("featureModal");
    modal.classList.add("hidden");
    modal.classList.remove("flex");
  }
  
  
  
</script>

{% endblock %}