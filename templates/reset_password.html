{% extends "layout.html" %}

{% block content %}

<div class="auth-card mx-auto animate-fade-in max-w-sm">

    <div class="text-center mb-6">
        <div class="bg-emerald-50 w-16 h-16 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-sm border border-emerald-100">
            <i class="fa-solid fa-lock-open text-emerald-500 text-3xl"></i>
        </div>
        <h2 class="text-xl font-extrabold text-slate-900 tracking-tight">
            New Password
        </h2>
        <p class="text-[13px] text-slate-500 mt-1 font-medium px-2">
            Set a strong password for your account.
        </p>
    </div>

    <form action="{{ url_for('reset_password') }}" method="POST" onsubmit="return validateForm()" class="space-y-4">

        <div>
            <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2 ml-1">
                New Password
            </label>
            <div class="relative group">
                <i class="fa-solid fa-key absolute left-4 top-1/2 -translate-y-1/2 text-slate-300 text-md z-10 group-focus-within:text-emerald-500 transition-colors"></i>
                
                <input type="password" id="password" name="password" required
                    placeholder="••••••••"
                    onkeyup="validateForm()"
                    class="w-full pl-11 pr-10 py-3 rounded-xl border border-slate-200 text-sm
                           focus:ring-4 focus:ring-emerald-500/10 focus:border-emerald-500 outline-none transition-all">
                
                <button type="button" class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-300 hover:text-slate-600 transition"
                   onclick="togglePassword('password', this.querySelector('i'))">
                    <i class="fa-solid fa-eye text-sm"></i>
                </button>
            </div>
            <p id="passwordError" class="text-[9px] font-bold text-red-500 mt-1.5 hidden leading-tight">
                <i class="fa-solid fa-circle-exclamation mr-1"></i> 6+ chars, one Upper, one Lower, one Num & one Symbol.
            </p>
        </div>

        <div>
            <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2 ml-1">
                Confirm Password
            </label>
            <div class="relative group">
                <i class="fa-solid fa-shield-check absolute left-4 top-1/2 -translate-y-1/2 text-slate-300 text-md z-10 group-focus-within:text-emerald-500 transition-colors"></i>
                
                <input type="password" id="confirm_password" name="password2" required
                    placeholder="••••••••"
                    onkeyup="validateForm()"
                    class="w-full pl-11 pr-10 py-3 rounded-xl border border-slate-200 text-sm
                           focus:ring-4 focus:ring-emerald-500/10 focus:border-emerald-500 outline-none transition-all">
                
                <button type="button" class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-300 hover:text-slate-600 transition"
                   onclick="togglePassword('confirm_password', this.querySelector('i'))">
                    <i class="fa-solid fa-eye text-sm"></i>
                </button>
            </div>
            <p id="confirmPasswordError" class="text-[9px] font-bold text-red-500 mt-1.5 hidden">
                <i class="fa-solid fa-circle-xmark mr-1"></i> Passwords do not match.
            </p>
        </div>

        <button type="submit"
            class="w-full bg-slate-900 text-white py-3.5 rounded-xl text-xs font-bold
                   flex items-center justify-center gap-2 shadow-lg shadow-slate-100
                   hover:bg-emerald-600 transition-all active:scale-95 mt-2">
            <i class="fa-solid fa-check-double"></i>
            UPDATE PASSWORD
        </button>

    </form>

</div>

<script>
function togglePassword(fieldId, icon) {
    const input = document.getElementById(fieldId);
    if (input.type === "password") {
        input.type = "text";
        icon.classList.replace('fa-eye', 'fa-eye-slash');
    } else {
        input.type = "password";
        icon.classList.replace('fa-eye-slash', 'fa-eye');
    }
}

function validateForm() {
    const password = document.getElementById('password');
    const confirm = document.getElementById('confirm_password');
    const passError = document.getElementById('passwordError');
    const matchError = document.getElementById('confirmPasswordError');

    const regex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&]).{6,}$/;
    let valid = true;

    // Strength Check
    if (password.value !== "" && !regex.test(password.value)) {
        passError.classList.remove('hidden');
        password.classList.add('border-red-300');
        valid = false;
    } else {
        passError.classList.add('hidden');
        password.classList.remove('border-red-300');
    }

    // Match Check
    if (confirm.value !== "" && password.value !== confirm.value) {
        matchError.classList.remove('hidden');
        confirm.classList.add('border-red-300');
        valid = false;
    } else {
        matchError.classList.add('hidden');
        confirm.classList.remove('border-red-300');
    }

    return valid;
}
</script>

{% endblock %}