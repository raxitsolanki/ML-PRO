<!DOCTYPE html>
<html lang="en">
<head>
    <title>DPS Admin</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- FontAwesome -->
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='admin/admin.css') }}">
</head>

<body class="bg-gray-100 h-screen overflow-hidden">

<div class="flex h-full">

    <!-- ================= HEADER ================= -->
    {% if session.get('admin_logged_in') %}
    <header class="bg-white shadow px-6 py-4 flex justify-between items-center h-16 fixed w-full z-20">
        <div class="flex items-center gap-3">
            <button id="hamburgerBtn" class="md:hidden text-gray-700 focus:outline-none">
                <i class="fa-solid fa-bars text-xl"></i>
            </button>

            <a href="{{ url_for('admin_dashboard') }}" class="flex items-center gap-3">
                <i class="fa-solid fa-heart-pulse text-[#5b21b6] text-2xl"></i>
                <span class="font-bold text-xl text-gray-800">DPS Admin</span>
            </a>
        </div>

        <div class="flex items-center gap-4 text-sm text-gray-600">
            <div class="flex items-center gap-2">
                <i class="fa-solid fa-user-shield text-[#5b21b6]"></i>
                <span>{{ session.admin_username }}</span>
            </div>

            <a href="{{ url_for('admin_logout') }}"
               class="flex items-center gap-2 px-3 py-1 rounded-lg bg-red-500 hover:bg-red-600 text-white transition">
                <i class="fa-solid fa-right-from-bracket"></i>
                Logout
            </a>
        </div>
    </header>
    {% endif %}

    <!-- ================= SIDEBAR ================= -->
    {% if session.get('admin_logged_in') %}
    <aside id="sidebar"
           class="w-64 bg-[#5b21b6] text-white flex flex-col fixed top-16 h-[calc(100%-4rem)]
                  transform -translate-x-full md:translate-x-0 transition-transform duration-300 z-10">

        <div class="p-6 flex items-center gap-3 border-b border-purple-400">
            <i class="fa-solid fa-heart-pulse text-2xl"></i>
            <span class="text-xl font-bold tracking-wide">Admin Panel</span>
        </div>

        <nav class="flex-1 px-4 py-6 space-y-2 overflow-y-auto">
            <a href="{{ url_for('admin_dashboard') }}"
               class="flex items-center gap-3 p-3 rounded-lg transition
               {% if request.endpoint == 'admin_dashboard' %} bg-white/10 {% else %} hover:bg-white/10 {% endif %}">
                <i class="fa-solid fa-house"></i> Dashboard
            </a>
            <a href="{{ url_for('admin_users') }}"
               class="flex items-center gap-3 p-3 rounded-lg transition
               {% if request.endpoint == 'admin_users' %} bg-white/10 {% else %} hover:bg-white/10 {% endif %}">
                <i class="fa-solid fa-users"></i> Users
            </a>
            <a href="{{ url_for('admin_messages') }}"
               class="flex items-center gap-3 p-3 rounded-lg transition
               {% if request.endpoint == 'admin_messages' %} bg-white/10 {% else %} hover:bg-white/10 {% endif %}">
                <i class="fa-solid fa-envelope"></i> Messages
            </a>
            <a href="{{ url_for('admin_prediction') }}"
   class="flex items-center gap-3 p-3 rounded-lg transition
   {% if request.endpoint == 'admin_prediction' %} bg-white/10 {% else %} hover:bg-white/10 {% endif %}">
    <i class="fa-solid fa-microscope"></i> Predictions
</a>


<a href="{{ url_for('admin_user_analytics') }}"
   class="flex items-center gap-3 p-3 rounded-lg transition {% if request.endpoint == 'admin_user_analytics' %} bg-white/10 {% else %} hover:bg-white/10 {% endif %}">
   <i class="fa-solid fa-chart-line"></i> User Analytics
</a>


        </nav>

        <div class="p-4 border-t border-purple-400">
            <a href="{{ url_for('admin_logout') }}"
               class="flex items-center gap-3 p-2 rounded-lg
                      bg-red-500 hover:bg-red-600 transition justify-center">
                <i class="fa-solid fa-right-from-bracket"></i>
                Logout
            </a>
        </div>
    </aside>
    {% endif %}

    <!-- ================= MAIN ================= -->
    <div class="{% if session.get('admin_logged_in') %}flex-1 md:ml-64 flex flex-col h-full pt-16{% else %}flex-1 flex flex-col h-full pt-16{% endif %}">

      
        {% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
<div id="toast-container" class="fixed top-20 right-5 z-50 flex flex-col gap-3">
    {% for category, message in messages %}
        <div class="flex items-start gap-3 px-4 py-3 rounded-lg shadow-lg relative
                    {% if category == 'success' %} bg-white border-l-4 border-[#5b21b6] text-black
                    {% elif category in ['error','danger'] %} bg-red-100 border-l-4 border-red-500 text-black
                    {% else %} bg-blue-100 border-l-4 border-blue-500 text-black {% endif %}">
            
            <!-- Icon -->
            <i class="fa-solid 
                {% if category == 'success' %} fa-circle-check text-[#5b21b6]
                {% elif category in ['error','danger'] %} fa-circle-exclamation text-red-500
                {% else %} fa-circle-info text-blue-500 {% endif %}
                text-xl mt-0.5"></i>

            <!-- Message -->
            <div class="flex-1">
                <p class="text-sm font-bold"> 
                    {% if category == 'success' %} Success
                    {% elif category in ['error','danger'] %} Error
                    {% else %} Notification {% endif %}
                </p>
                <p class="text-xs">{{ message }}</p>
            </div>

            <!-- Manual Close Button -->
            <button onclick="this.closest('div').remove()" 
                    class="absolute top-2 right-2 text-gray-400 hover:text-gray-600">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </div>
    {% endfor %}
</div>
{% endif %}
{% endwith %}

        <!-- ================= CONTENT ================= -->
        <main class="flex-1 overflow-y-auto p-6">
            {% block content %}{% endblock %}
        </main>
    </div>

</div>

<!-- ================= SCRIPTS ================= -->
<script>
const hamburgerBtn = document.getElementById('hamburgerBtn');
const sidebar = document.getElementById('sidebar');
if(hamburgerBtn){
  hamburgerBtn.addEventListener('click', () => {
      sidebar.classList.toggle('-translate-x-full');
  });
}
</script>


</body>
</html>
